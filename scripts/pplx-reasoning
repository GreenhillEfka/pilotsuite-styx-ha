#!/bin/bash
# pplx-reasoning - Perplexity AI Web Search (sonar-reasoning-pro - deep analysis)
# Usage: pplx-reasoning "your complex query here"

set -e

API_KEY="${PERPLEXITY_API_KEY:-}"
MODEL="sonar-reasoning-pro"
MAX_TOKENS="${PPLX_MAX_TOKENS:-8192}"

if [ -z "$API_KEY" ]; then
    echo "Error: PERPLEXITY_API_KEY not set" >&2
    exit 1
fi

if [ -z "$1" ]; then
    echo "Usage: pplx-reasoning \"your query\"" >&2
    exit 1
fi

QUERY="$*"

curl -s -X POST "https://api.perplexity.ai/chat/completions" \
    -H "Authorization: Bearer $API_KEY" \
    -H "Content-Type: application/json" \
    -d "{
        \"model\": \"$MODEL\",
        \"messages\": [{\"role\": \"user\", \"content\": $(jq -Rs . <<< "$QUERY")}],
        \"max_tokens\": $MAX_TOKENS
    }" | jq -r '.choices[0].message.content // .error.message // "No response"'